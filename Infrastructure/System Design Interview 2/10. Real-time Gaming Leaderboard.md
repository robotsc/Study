# Real-time Gaming Leaderboard

- 이번 장에서는 온라인 모바일 게임에서 사용되는 순위표를 설계해볼 것이다.

- 순위표란 무엇일까? 순위표는 토너먼트, 대결 등의 상황에서 사용자들의 순위를 나타낸다. 사용자들은 특정 작업이나 챌린지를 통과해  
  포인트를 획득할 수 있으며, 포인트가 많으면 많을수록 순위가 올라간다. 아래 그림은 모바일 게임에서 사용되는 순위표의 예시이다.

![picture 76](/images/SDI2_RGL_1.png)

## 문제 이해 및 설계 범위 확정

- 순위표는 상당히 직관적이지만 구현 할 때 복잡도를 증가시킬 수 있는 요소들이 많다. 따라서 다른 시스템 설계와 마찬가지로 우선  
  요구사항을 확실히 정의해야 한다.

### 기능적 요구사항

- 사용자는 토너먼트 동안 경기를 승리하면 포인트를 획득한다. 그리고 승리 시 마다 포인트가 누적된다.
- 모든 사용자는 순위표에 나타나야 한다.
- 순위표는 매달 초기화된다.
- 토너먼트 중 DAU는 500만명이며 MAU는 2500만명이다.
- 순위표는 기본적으로 top 10 사용자들 만을 표시한다.
- 토너먼트 중 한 사용자는 평균적으로 하루에 10개의 경기를 진행한다.
- 2명 이상의 사용자가 동일한 포인트를 가지고 있다면, 이들의 순위는 같은 순위로 취급된다.
- 순위표는 실시간으로 갱신되어야 한다.(near real-time도 허용)

### 비 기능적 요구사항

- 일반적인 확장성, 가용성, 안정성 요구사항들(높으면 높을 수록 좋다.)

### 추정치 계산

- 우리가 설계할 순위표의 규모를 파악하기 위해 몇 가지 수치들을 계산해보자.

- DAU가 500만명인 상황에서 사용자들이 균등한 분포로 경기를 진행한다고 했을 때 초당 `5,000,000 / 10^5 = 50`명이 경기를 진행한다.  
  하지만 실세계에서 이렇게 계산하는 경우는 적다. Peak hour가 존재하기도 하고, 시간대가 지역마다 다르기 때문에 사용량이 시간 마다 다르다.  
  이를 반영하기 위해 peak 시간대에는 평균보다 5배의 사용자가 있다고 해보자. 따라서 peak 시간대에는 초당 250명의 사용자들이 경기를 진행한다.

- 사용자가 평균적으로 하루에 10개의 경기를 진행하므로 사용자가 포인트를 획득하는 QPS는 `50 * 10 = 500`이다.  
  Peak QPS는 `500 * 5 = 2500`이다.

- 마지막으로 Top 10 사용자들을 순위표에서 조회하는 QPS를 계산해보자. 사용자가 게임에 하루에 한 번 접속한다고 가정했을 때 top 10 순위표는  
  사용자가 처음 게임에 접속했을 때 불러와진다. 따라서 QPS는 50 정도 될 것이다.

---
