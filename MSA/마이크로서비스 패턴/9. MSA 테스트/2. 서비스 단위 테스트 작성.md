# 서비스 단위 테스트 작성

- 주문 서비스에서 주문 소계(subtotal)가 정확히 계산되는지를 테스트한다 해보자. 주문 서비스를 실행하고, 주문 생성 REST API를  
  호출한 후 반환된 HTTP 응답에 기대값이 포함되어 있는지 테스트 코드를 작성해 확인해야 할 것이다. 그러나 이렇게 작성한 테스트는  
  복잡하고 속도가 느리다. 단지 `Order` 클래스의 단위 테스트를 작성하는 것이 훨씬 생산적인 접근 방식이다.

- 개발을 지원하는 기술 관련 테스트인 단위 테스트는 테스트 피라미드의 최하단에 있다. 단위 테스트는 서비스의 아주 작은 부속품, 즉  
  단위(unit)가 제대로 동작하는지 확인한다. 일반적으로 단위는 클래스이므로 단위 테스트는 해당 클래스가 예상대로 잘 동작하는지  
  확인하는 것이 목표이다.

  ![picture 43](/images/MSAP_9_9.png)

- 단위 테스트에는 아래의 두 가지 종류가 있다.

  - 독립(solitary) 단위 테스트: 클래스의 의존성을 mock 객체로 나타내고 클래스를 따로 테스트한다.
  - 공동(sociable) 단위 테스트: 클래스와 의존성을 테스트한다.

- 어떤 종류의 단위 테스트를 할지는 클래스의 책임과 아키텍쳐에서의 역할마다 다르다.  
  아래 그림은 전형적인 hexagonal 아키텍쳐, 그리고 각 클래스별로 많이 쓰이는 단위 테스트 종류이다. 일반적으로 controller와 서비스  
  클래스는 독립 단위 테스트, entity와 vo 같은 도메인 객체는 공동 단위 테스트를 사용한다.

  ![picture 44](/images/MSAP_9_10.png)

- 아래는 클래스별로 많이 쓰이는 테스트 전략이다.

  - 영속적으로 식별 가능한 entity는 공동 단위 테스트를 수행한다.
  - 값을 모아 놓은 VO는 공동 단위 테스트를 수행한다.
  - 여러 서비스에 걸쳐 데이터의 일관성을 유지하는 saga는 공동 단위 테스트를 수행한다.
  - Entity, VO 어디에도 속하지 않는 비즈니스 로직을 구현한 service 클래스, 즉 도메인 서비스는 독립 단위 테스트를 수행한다.
  - HTTP 요청을 처리하는 controller는 독립 단위 테스트를 수행한다.
  - Inbound/outbound messaging gateway는 독립 단위 테스트를 수행한다.

---
