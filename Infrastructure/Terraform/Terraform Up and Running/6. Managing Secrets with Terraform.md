# Managing Secrets with Terraform

- 데이터베이스 비밀번호, API Key, TLS 인증서 등 다양한 비밀 값이 포함되어 있는 상황이 발생할 수 있다.  
  예를 들어, 아래처럼 데이터베이스를 배포하기 위한 Terraform 코드가 있다고 해보자.

```tf
resource "aws_db_instance" "example" {
  identifier_prefix   = "terraform-up-and-running"
  engine              = "mysql"
  allocated_storage   = 10
  instance_class      = "db.t2.micro"
  skip_final_snapshot = true
  db_name             = var.db_name

  username = "???"
  password = "???"
}
```

- 위 코드는 username과 password, 2개의 비밀 값을 사용한다. 이러한 값들을 어떻게 안전하게 관리할까?

- 이 부분은 _secrets management_ 의 넓은 주제이며, 아래의 세 가지를 다룰 것이다.

  - Secret management basics
  - Secret management tools
  - Secret management tools with Terraform

## Secret management basics

- 가장 중요한 점은 **비밀 값을 plain text로 하드코딩하지 않는 것** 이다. 아래처럼 하지 말라는 것이다.

```tf
resource "aws_db_instance" "example" {
  identifier_prefix   = "terraform-up-and-running"
  engine              = "mysql"
  allocated_storage   = 10
  instance_class      = "db.t2.micro"
  skip_final_snapshot = true
  db_name             = var.db_name

  username = "admin"
  password = "password"
}
```

- Plain text로 비밀 값을 저장하는 것은 좋지 못한 생각이다. 아래는 그 이유 중 일부이다.

  - VCS에 접근 권한이 있는 누구나 비밀 값 또한 접근할 수 있다.
  - VCS에 접근 가능한 어떠한 컴퓨터도 비밀 값에 접근할 수 있다.
  - 실행되고 있는 소프트웨어들이 비밀 값에 접근할 수 있다.
  - 비밀 값의 접근 추적을 하거나 권한 회수가 불가능하다.

---
