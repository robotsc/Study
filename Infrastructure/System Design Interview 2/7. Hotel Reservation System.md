# Hotel Reservation System

- 이번 장에서는 Marriott International 등과 같은 호텔들의 예약 시스템을 설계해볼 것이다.  
  여기서 볼 설계와 기술들은 아래와 같이 예약과 관련된 다른 주제들에도 적용 가능하다.

  - Airbnb 설계
  - 항공 예약 시스템 설계
  - 영화 티켓 예약 시스템 설계

## 문제 이해 및 설계 범위 확정

- 호텔 예약 시스템은 복잡하고 사용되는 컴포넌트들은 비즈니스 요구사항에 따라 각각 다르다.  
  설계를 시작하기 전, 우선 요구사항을 확실히 파악해보자.

### 요구사항

- 5000개의 호텔이 있으며 총 100만개의 방이 있다.
- 예약 시 바로 결제가 이뤄진다.
- 사용자들은 호텔이 제공하는 웹사이트나 앱을 통해 예약할 수 있다.
- 예약은 취소할 수 있다.
- 10%의 overbooking을 허용한다.
  > Overbooking: 호텔이 실제로 가진 방 개수보다 더 많은 예약을 받도록 하는 것. 주로 예약 취소 등에 대해 대비하기 위해 사용된다.
- 아래의 사항들에 대해 집중한다.
  - 호텔 관련된 페이지 제공
  - 호텔 내의 방과 관련된 상세 페이지 제공
  - 방 예약
  - 호텔과 방 정보를 추가, 삭제, 갱신할 수 있는 어드민 페이지 제공
  - Overbooking 기능
- 호텔의 가격은 동적으로 변경된다. 예를 들어, 주어진 일자에 예약이 많을 것으로 예상되면 가격은 인상된다.  
  따라서 가격이 매일 다를 수 있다고 생각한다.

### 그 외의 요구사항들

- High concurrency: 성수기나 큰 행사가 있는 등의 상황에 동일한 방에 대해 예약을 하려 하는 고객들이 몰릴 수 있다.
- Moderate latency: 사용자가 예약을 할 때 빠른 response time이 있으면 좋지만, 예약 요청을 처리하는 데 최대 n초가 소요되도 된다.

### 수치화 및 추가 정보

- 위 요구사항들로부터 수치화한 내용들은 아래와 같다.

  - 총 5000개의 호텔이 있으며 100만개의 방이 있다.
  - 70%의 방이 이미 사용되고 있으며 평균 stay duration은 3일로 가정한다.
  - 일일 예상 예약 횟수: `100만 * 0.7 / 3 = 233,333`, 대략 240,000으로 가정한다.
  - 초당 예약 횟수: `240,000 / 10^5 = 3` (TPS가 그렇게 높지 않다.)

- 다음으로 이 시스템이 제공해야 하는 모든 페이지들의 QPS를 대략적으로 계산해보자.

  - 호텔, 방의 상세 피이지 조회(query)
  - 예약 페이지 조회(query): 사용자들은 일자, 사용자 수, 결제 정보 등 예약 상세 정보를 조회한다.
  - 방 예약(transaction): 사용자들은 _"예약"_ 버튼을 클릭해 방을 예약하고, 완료되면 방은 예약 처리 된다.

- 10%의 사용자들이 다음 depth로 넘어간다고 가정하고, 90%의 사용자들이 최종 단계까지 가기 전에 떨어져 나간다고 가정하자.  
  또한 prefetching feature이 없다고 가정하자. 아래 그림은 각 단계별로 대략적인 QPS를 나타낸다.  
  최종 예약에 대한 TPS가 3인 것은 주어졌으므로 이로부터 거꾸로 올라가 계산하면 된다. 예약 페이지의 QPS는 30이며 호텔 및 방에 대한  
  상세 페이지의 QPS는 300이다.

![picture 29](../../images/SDI2_HRS_1.png)

---
