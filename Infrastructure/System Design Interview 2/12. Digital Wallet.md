# Digital Wallet

- 결제 플랫폼들은 일반적으로 클라이언트에게 돈을 저장하고 사용할 수 있도록 해주는 전자 지갑 서비스를 제공한다.  
  예를 들어 신용 카드에 연결된 전자 지갑에 돈을 저장하고, 이후 온라인으로 상품을 구매할 때 해당 전자 지갑에 있는 돈을 사용할 수 있다.  
  아래 그림은 이 프로세스를 나타낸다.

  ![picture 16](/images/SDI2_DW_1.png)

- 전자 지갑이 제공하는 기능은 돈을 사용하는 것이 전부가 아니다. PayPal과 같은 결제 플랫폼에서는 동일한 플랫폼에 있는 다른 사람의  
  전자 지갑으로 돈을 송금할 수도 있다. 은행 계좌로 송금하는 것에 비해 이 송금 방식은 더욱 빠르며 추가적인 비용(수수료)을 발생시키지 않는다.  
  아래 그림은 전자 지갑 사이의 송금 과정을 나타낸다.

  ![picture 17](/images/SDI2_DW_2.png)

- 이번 장에서는 같은 플랫폼 사이의 직접 송금이 가능한 전자 지갑 애플리케이션의 백엔드 부분을 설계해보도록 하자.

## 문제 이해 및 설계 범위 확정

- 요구사항은 아래와 같다.

  - 두 개의 전자 지갑 사이의 송금 기능에만 집중한다.
  - TPS: 1,000,000(백만)
  - 데이터를 기반으로 잔액 기록을 재생성해낼 수 있어야 한다.
  - 가용성: 99.99%
  - 안정성: 99.99%
  - 트랜잭션 지원
  - 외화 거래는 고려하지 않는다.

### 개략적 추정치 계산

- TPS를 사용할 때 일반적으로 트랜잭션을 지원하는 데이터베이스를 사용한다고 가정하게 된다. 현대의 일반적인 data center node에서  
  실행되는 RDBMS는 초당 수천개의 트랜잭션을(1000 TPS) 지원한다. 하나의 데이터베이스 node가 1000 TPS를 지원한다 해보자.  
  위 요구사항처럼 1,000,000 TPS를 지원하기 위해선 최소 이의 2배인 2,000,000 TPS까지는 지원할 수 있어야 하며, 이는 곧  
  2000개의 node들이 필요함을 의미한다.

- 아래 표는 1개의 node가 처리할 수 있는 TPS에 따라 필요한 총 node들의 개수를 나타낸다.  
  하드웨어가 동일하다고 가정했을 때 node가 초당 처리할 수 있는 트랜잭션의 수가 많으면 많을 수록 최종적으로 필요한 node의 개수는  
  줄어들며, 이는 곧 하드웨어 비용을 절감할 수 있음을 나타낸다. 따라서 우리는 이번 설계에서 하나의 node가 가능한 많은 TPS를  
  지원하도록 해야 한다.

  | node당 TPS | node 개수 |
  | ---------- | --------- |
  | 100        | 20000     |
  | 1000       | 2000      |
  | 10000      | 200       |

---
