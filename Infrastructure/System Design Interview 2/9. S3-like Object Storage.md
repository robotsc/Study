# S3-like Object Storage

- 이번 장에서는 Amazon S3와 비슷한 object storage 서비스를 설계해보자.  
  S3는 AWS에 의해 제공되는 object storage이며 RESTful API를 기반으로 하는 인터페이스를 제공한다.  
  아래는 S3에 대한 사실 중 일부이다.

  - 2006년 6월: GA
  - 2010년: Versioning, Bucket Policy, Multipart upload 지원
  - 2011년: SSE, Multi-object Delete, Object Expiration 지원
  - 2013년: S3에 저장된 object 개수 2조개 달성
  - 2014, 2015년: Life Cycle Policy, Event Notification, Cross-Region Replication 지원
  - 2021년: S3에 저장된 object 개수 200조개 달성

- Object storage를 설계하기 전, 우선 몇 가지의 storage system들을 살펴보고, 용어들을 정의하자.

## Storage System 101

- 개략적으로 봤을 때 storage system들은 아래의 3개 카테고리로 나뉜다.

  - Block storage
  - File storage
  - Object storage

### Block storage

- Block storage는 1960년대에 탄생했다. HDD, SSD와 같이 서버에 물리적으로 연결된 storage device를 block storage라 한다.

- Block storage는 저장된 raw block들을 서버에게 volume으로 제공한다. 이렇게 함으로써 storage를 유연하고, 다양한 용도로 사용할 수  
  있게 했다. 서버는 raw block들을 format해 file system으로 사용할 수도 있고, block들에 대한 제어권을 특정 애플리케이션에게  
  넘길 수도 있다. 데이터베이스나 VM engine같은 몇 가지 애플리케이션들은 성능을 쥐어짜내기 위해 block들을 직접 관리한다.

- Block storage는 단지 물리적으로 연결된 storage는 아니다. 빠른 속도를 가진 네트워크로 서버에게 연결될 수도 있고, FC(Fibre Channel),  
  iSCSI 등의 표준 프로토콜로 서버에게 연결될 수도 있다. 개념적으로 네트워크로 연결된 block storage는 여전히 raw block을 다루며  
  서버 입장에서는 물리적으로 연결된 block storage와 동일하게 사용할 수 있다.

### File storage

- File storage는 block storage에 기반해 만들어진 storage system이며 파일과 디렉토리를 더 쉽게 다루기 위해 추상화되어 있다.  
  데이터는 file의 형식으로 계층적 디렉토리 구조 내에 저장된다. 일반적인 용도로 가장 많이 사용되는 storage solution은 file storage이다.  
  File storage는 SMB/CIFS, NFS 등의 일반적인 file-level 네트워크 프로토콜을 사용해 동시에 수많은 서버들로 연결되어질 수 있다.  
  그리고 file storage에 접근하는 서버들은 block 관리, volume formatting 등 복잡한 과정을 관리할 필요가 없다.  
  이러한 file storage의 단순함과 간편함은 특정 organization 내에서 여러 개의 파일, 디렉토리를 공유하기에 너무나 좋은 선택지가 된다.

### Object storage

- Object storage는 block storage, file storage에 비하면 최신 기술에 속한다. 그리고 항상 성능과 안전성, 확장성, 비용에 대해  
  tradeoff 관계가 형성된다. 주로 상대적으로 archiving이나 backup을 위해 사용되는 상대적으로 _"cold"_ 한 데이터를 저장하기 위해  
  많이 사용된다. Objec tsotrage는 모든 데이터를 flat한 구조에 object로 저장한다. 따라서 계층적인 디렉토리 구조가 없다.  
  데이터에 대한 접근은 일반적으로 RESTful API로 제공된다. 그리고 다른 storage들에 비해 상대적으로 처리 속도가 느린 편이다.  
  대부분의 public cloud provider는 Amazon S3, Google Object Storage, Azure Blob Storage와 같이 object storage를  
  제공한다.

#### 3개 storage system들의 비교

![picture 45](/images/SDI2_SOS_1.png)

- 아래 표는 block storage, file storage, 그리고 object storage를 비교한 내용을 가진다.

| 특성            | Block storage                                              | File storage                        | Object storage                        |
| --------------- | ---------------------------------------------------------- | ----------------------------------- | ------------------------------------- |
| Mutable content | Y                                                          | Y                                   | N(object versioning을 사용해야 한다.) |
| Cost            | High                                                       | Medium to high                      | Low                                   |
| Performance     | Medium to high, very high                                  | Medium to high                      | Low to medium                         |
| Consistency     | Strong consistency                                         | Strong consistency                  | Strong consistency                    |
| Data access     | SAS/iSCSI/FC                                               | Standard file access, CIFS/SMB, NFS | RESTful API                           |
| Scalability     | Medium                                                     | High                                | Vast                                  |
| Good for        | VMs(Virtual Machines), Database와 같은 고성능 애플리케이션 | 일반적인 용도의 file system access  | Binary data, unstructured data        |

### 용어 정의

- S3-like object storage를 설계하려면 우선 object storage의 핵심 개념을 정립해야 한다.  
  여기서는 관련 용어들과 그 내용을 정의해보자.

- **Bucket** : Object들의 논리적인 container. Bucket의 이름은 전역적으로 unique해야 하며 데이터를 S3에 upload하기 전, 먼저  
  bucket을 생성해야 한다.

- **Object** : Object는 bucket에 저장할 독립적인 데이터 조각을 말한다. Payload라고도 불리는 object data와 metadata를 가진다.  
  Object data는 저장하고 싶은 순차적인 byte가 될 수도 있고, meatadata는 object에 대한 정보를 담은 name-value pair들로 구성된다.

- **Versioning** : 같은 bucket 내의 한 object의 여러 변형을 저장하도록 하는 기능이다. Bucket-level에서 활성화시킬 수 있다.  
  이 기능은 의도치 않게 삭제되거나 갱신된(overwritten) object를 사용자들이 복구할 수 있게 한다.

- **URI(Uniform Resource Identifier)** : Object storage는 bucket, object에 접근하기 위해 RESTful API들을 제공한다.  
  이를 위해 각 리소스들은 URI로 구별된다.

- **SLA(Service-Level Agreement)** : SLA는 서비스 프로바이더와 클라이언트 사이의 계약이다.  
  예를 들어, Amazon S3 Standard-IA storage class는 아래의 SLA를 제공한다.

  - 여러 개의 AZ에 걸쳐 99.999999999%의 내구성을 위해 설계되었다.
  - 데이터는 하나의 AZ가 장애 나더라도 회복할 수 있다.
  - 99.9%의 가용성을 위해 설계되었다.

---
