# Transport layer

## Introduction to Transport-Layer Services

- Transport layer protocol은 서로 다른 host들에서 실행되고 있는 애플리케이션이 소통하기 위한 **논리적인 방법**을 제공한다.  
  _논리적_ 이라 함은 애플리케이션의 관점에서의 이야기인데, 애플리케이션 관점에서 host들은 마치 직접적으로 연결된 것처럼  
  소통하기 때문이다.

- Transport layer protocol들은 network router가 아닌 end system에 구현되어 있다.  
  송신자 측에서 transport layer는 application layer의 message들을 받아 transport layer segment로 변환한다.  
  이 과정에서 application layer를 작은 chunk들로 쪼개고, 각 chunk에 transport layer header를 추가하게 된다.  
  그 다음 이 segment들은 network layer datagram으로 캡슐화되어 network layer로 전달된다.

### Relationship between Transport and Network Layers

- Transport layer가 서로 다른 host들에서 실행되는 프로세스들 사이의 논리적인 소통 방식을 제공하는 반면,  
  Network layer는 서로 다른 host들 간의 논리적인 소통 방식을 제공한다.

### Overview of the Transport Layer in the Internet

- Internet은 아래의 2개 transport layer protocol을 application layer가 사용하도록 제공한다.

  - UDP(User Datagram Protocol): Unreliable, connectionless
  - TCP(Transmission Control Protocol): Reliable, Connection-oriented

> 용어의 간결함을 위해 TCP, UDP packet을 **segment**, 그리고 network-layer packet을 **datagram**이라고 부른다.

- IP(Internet Protocol)는 Internet의 network-layer protocol이며 서로 다른 host들의 논리적인 소통 방법을 제공하며  
  segment가 서로 다른 host들에게 전달되기 위해 _"best effort"_ 를 한다.(즉, 보장이 없다.) 특히 IP는 segment들의  
  순서를 보장하지 못하고 segment들의 무결성도 보장하지 못한다. 이러한 이유로 IP는 unreliable service이다.

- 위와 같은 IP의 한계를 보완하기 위해 UDP, TCP가 등장했다.

- Host들 사이의 데이터 전달을 process들 사이의 데이터 전달로 확장하는 것을 transport-layer multiplexing, demultiplexing이라 한다.

- UDP와 TCP는 segment header에 에러 감지 헤더를 담아 무결성을 검사할 수 있도록 한다.  
  여기까지 본 process-to-process data delivery와 무결성 검사가 UDP가 지원하는 기능의 전부이다.

- 반면 TCP는 reliable data transfer를 제공한다. Flow control, sequence number, ack, timer를 사용해 TCP는 데이터가  
  송신자로부터 수신자에게 잘 도달하고 순서도 맞음을 보장한다. 이렇게 TCP는 IP의 unreliable service를 reliable하게 해준다.  
  또한 TCP는 congestion control도 제공한다. 간단히 말해 TCP connection으로 데이터를 보내는 송신자 측을 조절해  
  congestion을 방지한다.

---

## Multiplexing and Demultiplexing

- 이번에는 transport-layer multiplexing과 demultiplexing에 대해 다뤄보자.  
  Transport-layer의 multiplexing은 network layer가 제공하는 host-to-host delivery service를  
  host 위에서 실행되는 애플리케이션들 사이의 process-to-process delivery service로 확장하는 것이다.

- 하나의 process는 하나 이상의 socket들을 가진다. 이 socket은 네트워크로부터 process로, 또는 그 반대로 데이터를 주고  
  받기 위한 하나의 관문이다. Socket이 있기에 수신자 host의 transport layer는 데이터를 직접적으로 process에 전달하지  
  않고, 대신 중간 socket에 전달하게 된다. 그리고 하나의 host에 여러 개의 socket이 있을 수 있기에 각 socket은 고유 ID를 가지게 된다.

- 그렇다면 수신자 host는 들어오는 transport-layer segment를 어떻게 적절한 socket에 전달할 수 있을까? 이를 위해서 각 transport-layer  
  segment는 필드를 가지게 된다. 이렇게 transport-layer segment의 데이터를 올바른 socket에 전달하는 것을 demultiplexing이라 한다.  
  반대로 송신자 host가 여러 개의 socket들로부터 data chunk들을 모아 header 정보들을 붙여 캡슐화하고, 이렇게 만들어진 segment를  
  network layer로 보내는 것을 multiplexing이라 한다.

- UDP socket은 destination IP address와 destination port number로만 구분된다.  
  따라서 만약 서로 다른 2개의 UDP segment가 source IP address 또는 source port number는 다르지만 destination IP address와  
  destination port number가 동일하다면 이 둘은 동일한 destination socket에 도달해 결국 동일한 process로 전달된다.

- TCP socket은 UDP socket과 달리 destination IP address, destination port number에 더해 source IP address와  
  source port number도 identifier로 사용된다.

---
