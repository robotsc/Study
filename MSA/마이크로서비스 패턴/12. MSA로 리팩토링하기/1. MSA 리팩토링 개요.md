# MSA 리팩토링 개요

## 모놀리틱 애플리케이션을 왜 리팩토링하는가?

- MSA는 여러모로 장점이 많다. 유지보수성, 테스트성, 배포성이 우수하고 개발을 빨리 할 수 있으며, 확장성도 우수하고 fault isolation도  
  잘 된다. 그리고 기술 스택을 발전시키기도 훨씬 쉽다. 하지만 모놀리틱 애플리케이션을 MSA로 리팩토링하는 작업은 매우 고되다.  
  무엇보다 새로운 기능 개발에 필요한 리소스가 분산된다.

- 이미 모놀리틱 지옥에 빠졌다면, 아래와 같은 비즈니스 문제를 적어도 하나는 격고 있다는 것이다.

  - **느린 전달** : 애플리케이션을 이해, 관리, 테스트하기가 어려워 개발자의 생산성이 떨어진다.
  - **버그가 많은 소프트웨어 배포** : 테스트성의 결여는 곧 소프트웨어 배포가 버그가 많을 때가 있다는 뜻이다.
  - **나쁜 확장성** : 모놀리틱 애플리케이션은 리소스 요건이 전혀 다른 모듈을 하나 이상의 실행 가능한 컴포넌트로 조합하기 때문에  
    확장이 어렵다. 어느 정도 이상은 확장할 수 없거나, 설령 가능하다 해도 비용이 많이 든다.

- 위 문제들이 있다 하더라도 해결 방안은 많다. 예를 들어 수동 테스트에 의존하고 있다면, 테스트를 자동화하기만 하더라도 개발 속도가 엄청  
  빨라질 것이다. 확장 문제도 아키텍처를 바꾸지 않고 해결할 수 있다. 이렇게 먼저 간단한 방안부터 시험해보고, 그래도 고질적인 문제가  
  해결되지 않는다면 그때 가서 MSA로의 전환을 고려해도 늦지 않다.

---

## Strangler application

- 애플리케이션 아키텍쳐를 모놀리틱에서 MSA로 전환하는 프로세스는 애플리케이션 현대화(application modernization)의 한 가지 형태이다.

- 기존 모놀리틱 애플리케이션을 완전히 뜯어 고치는 대신, 단계적으로 리팩토링하는 거이 좋다. 즉 기존 애플리케이션과 함께 실행되면서 새로운  
  마이크로서비스 애플리케이션을 조금씩 빌드한 strangler application을 개발하는 것이다. 이렇게 하면 시간이 지날수록 모놀리틱에  
  구현된 기능은 점점 줄어 완전히 없어지거나 또다른 마이크로서비스가 된다.

  ![picture 119](/images/MSAP_RF_1.png)

- 이러한 애플리케이션 현대화 전략은 strangler application 패턴이라고 불린다.

> Strangler application pattern: 레거시 애플리케이션에 새로운(strangler) 애플리케이션을 단계적으로 개발하는 애플리케이션 현대화 패턴.

- 리팩토링 작업은 보통 수 개월에서 수 년은 족히 걸린다. Amazon도 모놀리틱 애플리케이션을 리팩토링하는 데에만 2년이 걸렸다.

### 값을 초기에 자주 검증

- MSA로의 단계적인 리팩토링을 수행하면 투자에 따른 보상을 즉시 받을 수 있다. 모놀리틱을 조금씩 리팩토링하면서 새로운 기술 스택과 고속의 최신  
  devops 스타일로 신규 서비스를 각각 개발/전달할 수 잇다는 것이다. 덕분에 소프트웨어 전달 속도도 점점 빨라진다.

- 애플리케이션에서 가장 가치가 큰 부분을 먼저 마이크로서비스로 이전하는 것도 방법이다.

### 모놑리틱의 변경 최소화

- MSA로 전환할 때 모놀리틱 애플리케이션을 광범위하게 뜯어고치는 행위는 하지 말라는 말은 이번 장에서 반복되는 논지이다.  
  MSA로 전환하려면 모놀리틱을 어떤 식으로든 변경해야 하지만, 여기저기 많은 곳을 변경하는 것은 시간도 많이 걸리고, 비싸고, 위험하다.

### 기술 배포 인프라

- 최신 기술들이 가득한 인프라를 구축하고 싶을 것이지만, 인프라 개발에 필요한 선행 투자는 최소화하는 것이 좋다.  
  반드시 있어야 할 것으로는 테스트 자동화 배포 파이프라인이 유일하다. 예를 들어 서비스가 몇 개 안된다면 정교한 배포 인프라, 관측성  
  인프라는 당장 없어도 지장이 없다.

---
