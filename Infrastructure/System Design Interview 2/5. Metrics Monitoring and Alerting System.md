# Metrics Monitoring and Alerting System

- 이번 장에서는 확장성 있는 metric 모니터링 및 알림 시스템을 설계해볼 것이다.  
  잘 설계된 metric 모니터링 및 알림 시스템은 infrastructure가 고가용성과 안전성을 가지는 것을 보장하는 데 중요한 요소로 사용된다.

- 아래는 시장에 나와있는 유명한 metric 모니터링 및 알림 시스템들이다.

  - Datadog, Prometheus, Grafana
  - InfluxDB, New Relic, Nagios, Graphite

- 이번 장에서는 위와 비슷한 서비스를 만들고, 대형 회사들을 위한 시스템을 구축해보자.

## 문제 이해 및 설계 범위 확정

- Metric 모니터링 및 알림 시스템은 회사마다 매우 다르게 사용될 수 있으므로 설계 전에 정확히 요구사항들을 파악하는 것이 중요하다.  
  예를 들어 만약 intrastructure metric만 다뤄야 하는데 web server logging을 집중적으로 다루는 시스템을 설계하는 것은 옳지 않다.

- 이번에 설계할 시스템의 요구사항 및 추정치들은 아래와 같다.

  - 대형 규모의 infrastructure에 대한 모니터링을 제공한다.

    - DAU: 1억명
    - 1000개의 server pool이 있으며 각 pool에는 100개의 서버가 있고, 각 서버 당 100개의 metric을 기록한다.  
      따라서 1000만 개의 metric을 수집해야 한.
    - 데이터 저장 기간: 1년
    - 데이터 저장 정책: 7일 동안 raw data form, 30일 동안 1 minute resolution, 1년 동안 1 hour resolution

  - 아래와 같이 다양한 metric 정보들이 모니터링되어야 한다.
    - CPU usage
    - Request count
    - Memoru usage
    - Message count in message queues

- 아래는 기능적 요구사항이 아닌 다른 요구사항들이다.

  - 확장성(scalability): 시스템은 늘어나는 metric과 알림 양을 적절히 처리하기 위해 확장 가능해야 한다.
  - Low latency: 시스템은 대시보드 및 알림을 위해 query의 latency가 낮게 유지해야 한다.
  - 안전성(reliability): 시스템은 중요한 알림이 누락되는 것을 막기 위해 굉장히 안전성이 높아야 한다.
  - 유연성(flexibility): 기술이 지속적으로 변하기 때문에 pipeline은 미래의 새로운 기술들에도 연동하기 쉽게 유연해야 한다.

- 아래는 이번 시스템에서 다루지 않을 범위 밖의 내용들이다.

  - Log monitoring: ElasticSearch, Logstash, Kibana(ELK) stack이 로그를 모으고 모니터링하기 위해 매우 유명한 기술들이다.
  - Distributed system tracing: Distributed tracing은 요청이 처리되기 위해 사용되는 분산 시스템의 모든 것을 추적하기 위한 솔루션이다.  
    Request가 하나의 서비스로부터 다른 서비스로 갈 때의 데이터들을 모은다.

---
