# VM 패턴

- 서비스를 VM image로 묶어 production에 배포한다. 각 서비스 인스턴스가 하나의 VM이 된다.

## 장점

### VM image로 기술 스택을 캡슐화한다

- 서비스와 연관된 의존성들을 모두 VM image에 담을 수 있다. 서비스의 실행에 필요한 소프트웨어를 빈틈없이 설치/설정할 수 있으니 에러가 날  
  일도 거의 없다. 서비스를 VM으로 묶는다는 것은 기술 스택이 캡슐화된 black box를 만드는 것과 같다. VM image는 따로 수정할 필요 없이  
  어디라도 배포할 수 있다. 서비스 배포 API가 곧 VM 관리 API라서 더 간단하고 확실하게 배포할 수 있다.

### 서비스 인스턴스가 격리된다

- 각 서비스 인스턴스가 완전히 서로 떨어져 동작한다. 이것이 모든 VM 기술이 궁극적으로 추구하는 목표 중 하나이다.  
  정해진 CPU/memory 등의 리소스가 VM마다 배정되므로 다른 서비스에 있는 리소스를 빼앗아 올 수가 없다.

### 성숙한 클라우드 인프라를 활용한다

- 고도로 자동화한 클라우드 인프라를 적극적으로 활용할 수 있다. AWS 등의 public cloud provider는 물리 machine에 과부하를  
  유발하지 않는 방향으로 여러 VM을 scheduling하며, VM 간 load balancing 및 auto scaling 등의 부가 기능도 제공한다.

## 단점

### 리소스를 효율적으로 사용할 수 없다

- 서비스 인스턴스마다 OS를 포함한 전체 VM의 overhead가 존재한다. 또한 public IaaS VM은 대부분 크기가 한정되어 있어 적극  
  활용하기 어렵다. 상대적으로 무거운 JVM 기반 서비스라면 문제되지 않겠지만, 가벼운 Node.js나 Go등으로 구성된 서비스라면  
  비효율적인 배포 방식이다.

### 배포가 비교적 느리다

- '느리다'는 말은 상대적인 개념이지만, VM image는 대부분 크기가 커서 build time이 몇 분까지 걸리고 네트워크를 통해 이동하는  
  데이터량도 많다. VM image에서 VM instance를 생성할 때도 네트워크 데이터량이 많기 때문에 다소 시간이 걸리는 편이다.

### 시스템 관리 overhead가 발생한다

- OS, runtime patch를 해야 한다.

---
